From 8bd3ec37b6f9d267a3ccca8b9c72d3dcf9ef4f52 Mon Sep 17 00:00:00 2001
From: Jennifer Graul <jennifer.graul@wobcom.de>
Date: Tue, 4 Jul 2023 19:21:42 +0200
Subject: [PATCH] fix schema

---
 database/schema/2021-as-at-end-v5.sql | 47 +--------------------------
 1 file changed, 1 insertion(+), 46 deletions(-)

diff --git a/database/schema/2021-as-at-end-v5.sql b/database/schema/2021-as-at-end-v5.sql
index 1cff16a48..fce65ff61 100644
--- a/database/schema/2021-as-at-end-v5.sql
+++ b/database/schema/2021-as-at-end-v5.sql
@@ -487,24 +487,6 @@ CREATE TABLE `custkit` (
 ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;
 /*!40101 SET character_set_client = @saved_cs_client */;
 
---
--- Table structure for table `customer_to_ixp`
---
-
-DROP TABLE IF EXISTS `customer_to_ixp`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!40101 SET character_set_client = utf8 */;
-CREATE TABLE `customer_to_ixp` (
-  `customer_id` int(11) NOT NULL,
-  `ixp_id` int(11) NOT NULL,
-  PRIMARY KEY (`customer_id`,`ixp_id`),
-  KEY `IDX_E85DBF209395C3F3` (`customer_id`),
-  KEY `IDX_E85DBF20A5A4E881` (`ixp_id`),
-  CONSTRAINT `FK_E85DBF209395C3F3` FOREIGN KEY (`customer_id`) REFERENCES `cust` (`id`),
-  CONSTRAINT `FK_E85DBF20A5A4E881` FOREIGN KEY (`ixp_id`) REFERENCES `ixp` (`id`)
-) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
 --
 -- Table structure for table `customer_to_users`
 --
@@ -674,7 +656,6 @@ DROP TABLE IF EXISTS `infrastructure`;
 /*!40101 SET character_set_client = utf8 */;
 CREATE TABLE `infrastructure` (
   `id` int(11) NOT NULL AUTO_INCREMENT,
-  `ixp_id` int(11) NOT NULL,
   `name` varchar(255) COLLATE utf8_unicode_ci DEFAULT NULL,
   `shortname` varchar(255) COLLATE utf8_unicode_ci DEFAULT NULL,
   `isPrimary` tinyint(1) NOT NULL DEFAULT '0',
@@ -682,9 +663,7 @@ CREATE TABLE `infrastructure` (
   `ixf_ix_id` bigint(20) DEFAULT NULL,
   `country` varchar(2) COLLATE utf8_unicode_ci DEFAULT NULL,
   PRIMARY KEY (`id`),
-  UNIQUE KEY `IXPSN` (`shortname`,`ixp_id`),
-  KEY `IDX_D129B190A5A4E881` (`ixp_id`),
-  CONSTRAINT `FK_D129B190A5A4E881` FOREIGN KEY (`ixp_id`) REFERENCES `ixp` (`id`)
+  UNIQUE KEY `IXPSN` (`shortname`)
 ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;
 /*!40101 SET character_set_client = @saved_cs_client */;
 
@@ -783,27 +762,6 @@ CREATE TABLE `irrdbconfig` (
 ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;
 /*!40101 SET character_set_client = @saved_cs_client */;
 
---
--- Table structure for table `ixp`
---
-
-DROP TABLE IF EXISTS `ixp`;
-/*!40101 SET @saved_cs_client     = @@character_set_client */;
-/*!40101 SET character_set_client = utf8 */;
-CREATE TABLE `ixp` (
-  `id` int(11) NOT NULL AUTO_INCREMENT,
-  `name` varchar(255) COLLATE utf8_unicode_ci DEFAULT NULL,
-  `shortname` varchar(255) COLLATE utf8_unicode_ci DEFAULT NULL,
-  `address1` varchar(255) COLLATE utf8_unicode_ci DEFAULT NULL,
-  `address2` varchar(255) COLLATE utf8_unicode_ci DEFAULT NULL,
-  `address3` varchar(255) COLLATE utf8_unicode_ci DEFAULT NULL,
-  `address4` varchar(255) COLLATE utf8_unicode_ci DEFAULT NULL,
-  `country` varchar(255) COLLATE utf8_unicode_ci DEFAULT NULL,
-  PRIMARY KEY (`id`),
-  UNIQUE KEY `UNIQ_FA4AB7F64082763` (`shortname`)
-) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;
-/*!40101 SET character_set_client = @saved_cs_client */;
-
 --
 -- Table structure for table `l2address`
 --
@@ -1518,11 +1476,8 @@ CREATE TABLE `traffic_daily` (
   `year_max_out` bigint(20) DEFAULT NULL,
   `year_tot_in` bigint(20) DEFAULT NULL,
   `year_tot_out` bigint(20) DEFAULT NULL,
-  `ixp_id` int(11) NOT NULL,
   PRIMARY KEY (`id`),
   KEY `IDX_1F0F81A7BFF2A482` (`cust_id`),
-  KEY `IDX_1F0F81A7A5A4E881` (`ixp_id`),
-  CONSTRAINT `FK_1F0F81A7A5A4E881` FOREIGN KEY (`ixp_id`) REFERENCES `ixp` (`id`),
   CONSTRAINT `FK_1F0F81A7BFF2A482` FOREIGN KEY (`cust_id`) REFERENCES `cust` (`id`) ON DELETE CASCADE
 ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;
 /*!40101 SET character_set_client = @saved_cs_client */;
-- 
2.40.1

